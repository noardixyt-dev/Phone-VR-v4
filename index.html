<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Phone VR Camera Viewer</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  height: 100%;
  width: 100%;
  background: #000;
  display: flex;
  justify-content: center;
  align-items: center;
  touch-action: none;
}

#vr-container {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 100%;
  height: 100%;
}

.eye-container {
  position: relative;
  width: 45%;
  aspect-ratio: 1/1;
  margin: 0 10px;
  overflow: hidden;
  background: #000;
  border: 1px solid #222;
  border-radius: 16px;
}

.eye-container video {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 16px;
}

.menu {
  position: absolute;
  width: 180px;
  height: 100px;
  background: rgba(255,255,255,0.9);
  border-radius: 12px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 18px;
  color: #000;
  pointer-events: none;
  visibility: visible;
}

#fullscreen-btn, #fov-slider, #xaxis-slider, #xaxis-label {
  position: absolute;
  padding: 10px 16px;
  background: rgba(255,255,255,0.9);
  border-radius: 8px;
  font-size: 16px;
  z-index: 1000;
}

#fullscreen-btn { top: 20px; right: 20px; }
#fov-slider { top: 20px; left: 20px; width: 150px; }
#xaxis-label { top: 60px; left: 20px; color: black; font-size: 14px; font-weight: bold; }
#xaxis-slider { top: 80px; left: 20px; width: 150px; }

@media screen and (orientation: portrait) {
  body::before {
    content: "Please rotate your device to landscape";
    color: white;
    font-size: 2em;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
  }
  #vr-container { display: none; }
}
</style>
</head>
<body>

<div id="vr-container">
  <div id="left-eye-container" class="eye-container">
    <video id="left-eye" autoplay muted playsinline></video>
    <div class="menu" id="menu-left">VR Menu</div>
  </div>
  <div id="right-eye-container" class="eye-container">
    <video id="right-eye" autoplay muted playsinline></video>
    <div class="menu" id="menu-right">VR Menu</div>
  </div>
</div>

<button id="fullscreen-btn">Fullscreen</button>
<input type="range" id="fov-slider" min="20" max="50" value="45">
<label id="xaxis-label">X-Axis Movement</label>
<input type="range" id="xaxis-slider" min="-20" max="20" value="0">

<script>
const leftEye = document.getElementById('left-eye');
const rightEye = document.getElementById('right-eye');
const leftContainer = document.getElementById('left-eye-container');
const rightContainer = document.getElementById('right-eye-container');
const menuLeft = document.getElementById('menu-left');
const menuRight = document.getElementById('menu-right');
const fullscreenBtn = document.getElementById('fullscreen-btn');
const fovSlider = document.getElementById('fov-slider');
const xaxisSlider = document.getElementById('xaxis-slider');

let currentYaw = 0;
let currentPitch = 0;
let menuYaw = 0;
let menuPitch = 0;
let menuSpawned = false;

let menuPos = {xL:0, yL:0, xR:0, yR:0};
const yawMultiplier = 1.0;       // horizontal movement scaling
const pitchMultiplier = 1.5;     // vertical movement scaling, like YouTube VR
const smoothing = 0.25;           // responsiveness

const baseGap = 20;
const defaultWidth = 45;

// X-axis movement
let xOffset = 0;

// Start camera automatically
async function startCamera() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({
      video: { width: {ideal:3840}, height:{ideal:2160}, facingMode:'environment' },
      audio: false
    });
    leftEye.srcObject = stream;
    rightEye.srcObject = stream;
    leftEye.onloadedmetadata = () => leftEye.play();
    rightEye.onloadedmetadata = () => rightEye.play();
  } catch(err) {
    console.error("Camera error:", err);
    alert("Could not access camera. Please allow permissions.");
  }
}

startCamera();

// Fullscreen
fullscreenBtn.addEventListener('click', () => {
  if(document.fullscreenElement) document.exitFullscreen();
  else document.documentElement.requestFullscreen();
});

// Eye scale slider with dynamic gap
function updateEyeScaleAndGap() {
  const scale = fovSlider.value + '%';
  leftContainer.style.width = scale;
  rightContainer.style.width = scale;

  const dynamicGap = baseGap * (fovSlider.value / defaultWidth);
  leftContainer.style.marginLeft = dynamicGap/2 + "px";
  leftContainer.style.marginRight = dynamicGap/2 + "px";
  rightContainer.style.marginLeft = dynamicGap/2 + "px";
  rightContainer.style.marginRight = dynamicGap/2 + "px";

  // Apply X-axis offset
  leftContainer.style.transform = `translateX(${xOffset}px)`;
  rightContainer.style.transform = `translateX(${xOffset}px)`;
}
updateEyeScaleAndGap();
fovSlider.addEventListener('input', updateEyeScaleAndGap);
xaxisSlider.addEventListener('input', () => {
  xOffset = xaxisSlider.value + "px";
  updateEyeScaleAndGap();
});

// Device orientation
window.addEventListener('deviceorientation', (event) => {
  if(event.alpha !== null && event.beta !== null){
    currentYaw = event.alpha;
    currentPitch = event.beta;
    if(menuSpawned) updateMenuPosition();
  }
});

// Double-tap detection
let lastTap = 0;
window.addEventListener('touchend', (e) => {
  const now = new Date().getTime();
  if(now - lastTap < 300 && now - lastTap > 0){
    spawnMenu();
    e.preventDefault();
    e.stopPropagation();
  }
  lastTap = now;
});

function spawnMenu(){
  menuSpawned = true;
  menuYaw = currentYaw;
  menuPitch = currentPitch;
}

// Lerp helper
function lerp(a, b, t){ return a + (b - a) * t; }

// Menu projection relative to spawn yaw/pitch (world-locked)
function updateMenuPosition() {
  const fov = 100;
  const vFov = 80;

  const deltaYaw = ((menuYaw - currentYaw + 540) % 360) - 180;
  const deltaPitch = menuPitch - currentPitch;

  const lRect = leftContainer.getBoundingClientRect();
  const rRect = rightContainer.getBoundingClientRect();

  const targetXL = (lRect.width/2) + (deltaYaw/(fov/2))* (lRect.width/2) * yawMultiplier - menuLeft.offsetWidth/2;
  const targetYL = (lRect.height/2) + (deltaPitch/(vFov/2)) * (lRect.height/2) * pitchMultiplier - menuLeft.offsetHeight/2;
  const targetXR = (rRect.width/2) + (deltaYaw/(fov/2)) * (rRect.width/2) * yawMultiplier - menuRight.offsetWidth/2;
  const targetYR = (rRect.height/2) + (deltaPitch/(vFov/2)) * (rRect.height/2) * pitchMultiplier - menuRight.offsetHeight/2;

  menuPos.xL = lerp(menuPos.xL, targetXL, smoothing);
  menuPos.yL = lerp(menuPos.yL, targetYL, smoothing);
  menuPos.xR = lerp(menuPos.xR, targetXR, smoothing);
  menuPos.yR = lerp(menuPos.yR, targetYR, smoothing);

  menuLeft.style.left = menuPos.xL + "px";
  menuLeft.style.top = menuPos.yL + "px";
  menuRight.style.left = menuPos.xR + "px";
  menuRight.style.top = menuPos.yR + "px";

  menuLeft.style.visibility = "visible";
  menuRight.style.visibility = "visible";
}
</script>
</body>
</html>
