<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Phone VR Camera Viewer</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    height: 100%;
    width: 100%;
    background: #000;
    display: flex;
    justify-content: center;
    align-items: center;
    touch-action: none;
  }

  #vr-container {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    height: 100%;
  }

  .eye-container {
    position: relative;
    width: 33%;          /* slightly smaller for proper FOV */
    aspect-ratio: 1/1;   /* square */
    margin: 0 5px;       /* small gap between eyes */
    background: #000;
    overflow: hidden;
    border: 1px solid #222;
  }

  .eye-container video {
    width: 100%;
    height: 100%;
    object-fit: contain;  /* show full camera feed */
  }

  .menu {
    position: absolute;
    width: 180px;
    height: 100px;
    background: rgba(255,255,255,0.9);
    border-radius: 12px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 18px;
    color: #000;
    pointer-events: none;
    visibility: hidden;
  }

  #fullscreen-btn {
    position: absolute;
    top: 20px;
    right: 20px;
    padding: 10px 16px;
    background: rgba(255,255,255,0.9);
    border-radius: 8px;
    font-size: 16px;
    z-index: 1000;
  }

  @media screen and (orientation: portrait) {
    body::before {
      content: "Please rotate your device to landscape";
      color: white;
      font-size: 2em;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
    }
    #vr-container { display: none; }
  }
</style>
</head>
<body>

<div id="vr-container">
  <div id="left-eye-container" class="eye-container">
    <video id="left-eye" autoplay muted playsinline></video>
    <div class="menu" id="menu-left">VR Menu</div>
  </div>
  <div id="right-eye-container" class="eye-container">
    <video id="right-eye" autoplay muted playsinline></video>
    <div class="menu" id="menu-right">VR Menu</div>
  </div>
</div>

<button id="fullscreen-btn">Fullscreen</button>

<script>
const leftEye = document.getElementById('left-eye');
const rightEye = document.getElementById('right-eye');
const leftContainer = document.getElementById('left-eye-container');
const rightContainer = document.getElementById('right-eye-container');
const menuLeft = document.getElementById('menu-left');
const menuRight = document.getElementById('menu-right');
const fullscreenBtn = document.getElementById('fullscreen-btn');

let currentYaw = 0;
let currentPitch = 0;
let menuYaw = 0;
let menuPitch = 0;
let menuSpawned = false;

// Start camera automatically at high resolution
async function startCamera() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({
      video: {
        width: { ideal: 3840 },
        height: { ideal: 3840 },
        facingMode: 'environment'
      },
      audio: false
    });
    leftEye.srcObject = stream;
    rightEye.srcObject = stream;

    // Force video to play on mobile
    leftEye.onloadedmetadata = () => leftEye.play();
    rightEye.onloadedmetadata = () => rightEye.play();

  } catch(err) {
    console.error("Camera error:", err);
    alert("Could not access camera. Please allow permissions.");
  }
}

startCamera();

// Fullscreen button
fullscreenBtn.addEventListener('click', () => {
  if(document.fullscreenElement) {
    document.exitFullscreen();
  } else {
    document.documentElement.requestFullscreen();
  }
});

// Device orientation tracking
window.addEventListener('deviceorientation', (event) => {
  if(event.alpha !== null && event.beta !== null){
    currentYaw = event.alpha;
    currentPitch = event.beta;
    if(menuSpawned) updateMenuPosition();
  }
});

// Double-tap detection
let lastTap = 0;
window.addEventListener('touchend', (e) => {
  const now = new Date().getTime();
  if(now - lastTap < 300 && now - lastTap > 0){
    spawnMenu();
    e.preventDefault();
    e.stopPropagation();
  }
  lastTap = now;
});

function spawnMenu(){
  menuSpawned = true;
  menuYaw = currentYaw;
  menuPitch = currentPitch;
  menuLeft.style.visibility = "visible";
  menuRight.style.visibility = "visible";
}

function updateMenuPosition() {
  const fov = 100;  // horizontal FOV
  const vFov = 80;  // vertical FOV

  // Correct world-locked offsets
  let yawOffset = ((menuYaw - currentYaw + 540) % 360) - 180;  // menu stays fixed in world
  let pitchOffset = menuPitch - currentPitch;                   // looking up moves menu down, etc.

  const visible = Math.abs(yawOffset) <= fov/2 && Math.abs(pitchOffset) <= vFov/2;

  if(visible){
    // Left eye
    const lRect = leftContainer.getBoundingClientRect();
    let xL = (lRect.width/2) + (yawOffset/(fov/2))*(lRect.width/2) - menuLeft.offsetWidth/2;
    let yL = (lRect.height/2) + (pitchOffset/(vFov/2))*(lRect.height/2) - menuLeft.offsetHeight/2;
    menuLeft.style.left = xL + "px";
    menuLeft.style.top = yL + "px";

    // Right eye
    const rRect = rightContainer.getBoundingClientRect();
    let xR = (rRect.width/2) + (yawOffset/(fov/2))*(rRect.width/2) - menuRight.offsetWidth/2;
    let yR = (rRect.height/2) + (pitchOffset/(vFov/2))*(rRect.height/2) - menuRight.offsetHeight/2;
    menuRight.style.left = xR + "px";
    menuRight.style.top = yR + "px";

    menuLeft.style.visibility = "visible";
    menuRight.style.visibility = "visible";
  } else {
    menuLeft.style.visibility = "hidden";
    menuRight.style.visibility = "hidden";
  }
}
</script>
</body>
</html>
