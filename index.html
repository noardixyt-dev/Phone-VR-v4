<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AR Mixed Reality</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { position: absolute; top: 0; left: 0; }
  </style>
</head>
<body>
  <canvas id="leftCanvas"></canvas>
  <canvas id="rightCanvas"></canvas>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script>
    let xrSession = null;
    let renderer, scene, cameraLeft, cameraRight, controller;
    let leftCanvas = document.getElementById('leftCanvas');
    let rightCanvas = document.getElementById('rightCanvas');

    async function initAR() {
      if (!navigator.xr) {
        alert("WebXR not supported on this device.");
        return;
      }

      xrSession = await navigator.xr.requestSession('immersive-ar', {
        requiredFeatures: ['hit-test'],
        optionalFeatures: ['local', 'dom-overlay']
      });

      xrSession.addEventListener('end', onSessionEnded);

      renderer = new THREE.WebGLRenderer({ canvas: leftCanvas });
      renderer.autoClear = false;
      scene = new THREE.Scene();

      cameraLeft = new THREE.PerspectiveCamera(90, window.innerWidth / window.innerHeight, 0.1, 1000);
      cameraRight = new THREE.PerspectiveCamera(90, window.innerWidth / window.innerHeight, 0.1, 1000);

      controller = renderer.xr.getController(0);
      xrSession.addEventListener('selectstart', onSelectStart);

      animate();
    }

    function animate() {
      if (xrSession) {
        xrSession.requestAnimationFrame(animate);
      }

      renderer.render(scene, cameraLeft);
      renderer.render(scene, cameraRight);
    }

    function onSelectStart(event) {
      // Handle model placement
    }

    function onSessionEnded() {
      xrSession = null;
      renderer.dispose();
    }

    window.addEventListener('resize', () => {
      leftCanvas.width = rightCanvas.width = window.innerWidth;
      leftCanvas.height = rightCanvas.height = window.innerHeight;
      cameraLeft.aspect = cameraRight.aspect = window.innerWidth / window.innerHeight;
      cameraLeft.updateProjectionMatrix();
      cameraRight.updateProjectionMatrix();
    });

    initAR();
  </script>
</body>
</html>
