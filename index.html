<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>VR AR Menu</title>
<style>
  html, body { margin:0; padding:0; height:100%; overflow:hidden; background:#000; font-family:system-ui; }
  #ui { position:absolute; top:10px; left:10px; z-index:10; color:#fff; }
  #fullscreenBtn { position:absolute; top:10px; right:10px; z-index:10; }
  #fovSlider { position:absolute; top:10px; left:10px; z-index:10; }
  #leftEye, #rightEye { position:absolute; top:0; width:45%; height:100%; overflow:hidden; }
  #leftEye { left:0; }
  #rightEye { right:0; }
</style>
</head>
<body>

<div id="leftEye"></div>
<div id="rightEye"></div>

<div id="ui">
  <input type="range" id="fovSlider" min="50" max="120" value="70">
</div>
<button id="fullscreenBtn">Fullscreen</button>

<script src="three.min.js"></script>
<script src="menu-tracking.js"></script>
<script src="hand-tracking.js"></script>
<script>
const fovSlider = document.getElementById('fovSlider');
const leftEye = document.getElementById('leftEye');
const rightEye = document.getElementById('rightEye');
const fullscreenBtn = document.getElementById('fullscreenBtn');

let cameraStream;

// Request rear camera and render to both eyes
async function startCamera() {
  cameraStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment', width: { ideal: 3840 }, height: { ideal: 2160 } }, audio:false });
  const video = document.createElement('video');
  video.srcObject = cameraStream;
  video.play();
  video.onloadedmetadata = () => {
    [leftEye, rightEye].forEach(eye => {
      const vidClone = video.cloneNode();
      vidClone.autoplay = true;
      vidClone.muted = true;
      vidClone.playsInline = true;
      eye.innerHTML = '';
      eye.appendChild(vidClone);
    });
  }
}

// Fullscreen button
fullscreenBtn.addEventListener('click', () => {
  document.documentElement.requestFullscreen();
});

// FOV slider
fovSlider.addEventListener('input', () => {
  const scale = fovSlider.value/70;
  leftEye.style.width = `${45*scale}%`;
  rightEye.style.width = `${45*scale}%`;
});

// Double-tap menu spawn
let lastTap = 0;
document.body.addEventListener('touchend', (e) => {
  const currentTime = new Date().getTime();
  const tapLength = currentTime - lastTap;
  if (tapLength < 300 && tapLength > 0) {
    spawnMenu();
  }
  lastTap = currentTime;
});

// Start camera automatically
startCamera();

// Initialize AR/6DOF menu
initMenuTracking();

// Initialize hand tracking
initHandTracking();
</script>
</body>
</html>
