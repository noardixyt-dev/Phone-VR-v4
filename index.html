<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Phone VR Viewer</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  width: 100%;
  height: 100%;
  background: #000;
  touch-action: none;
  user-select: none;
}
#vr-container {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 100%;
  height: 100%;
}
.eye-container {
  position: relative;
  width: 45%;
  aspect-ratio: 1.5 / 1;
  margin: 0 20px;
  overflow: hidden;
  background: #000;
  border-radius: 18px;
}
.eye-container video {
  width: auto;
  height: 100%;
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  object-fit: cover;
  border-radius: 18px;
}
.menu {
  position: absolute;
  width: 180px;
  height: 100px;
  background: rgba(255, 255, 255, 0.9);
  border-radius: 12px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 18px;
  color: #000;
  pointer-events: none;
  visibility: hidden;
}
#fullscreen-btn, #fov-slider {
  position: absolute;
  padding: 6px 10px;
  background: rgba(255,255,255,0.9);
  border-radius: 8px;
  font-size: 14px;
  z-index: 1000;
}
#fullscreen-btn { top: 20px; right: 20px; }
#fov-slider { top: 20px; left: 20px; width: 140px; }
#fov-label {
  top: 50px;
  left: 20px;
  color: white;
  font-size: 14px;
  font-weight: bold;
  position: absolute;
  z-index: 1000;
}
#overlay-start {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: #000;
  display: flex;
  justify-content: center;
  align-items: center;
  color: white;
  font-size: 24px;
  text-align: center;
  z-index: 2000;
  touch-action: none;
}
@media screen and (orientation: portrait) {
  body::before {
    content: "Please rotate your device to landscape";
    color: white;
    font-size: 2em;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
  }
  #vr-container { display: none; }
}
</style>
</head>
<body>
<div id="overlay-start">Tap to start camera</div>
<div id="vr-container">
  <div id="left-eye-container" class="eye-container">
    <video id="left-eye" autoplay muted playsinline></video>
    <div class="menu" id="menu-left">VR Menu</div>
  </div>
  <div id="right-eye-container" class="eye-container">
    <video id="right-eye" autoplay muted playsinline></video>
    <div class="menu" id="menu-right">VR Menu</div>
  </div>
</div>
<button id="fullscreen-btn">Fullscreen</button>
<label id="fov-label">FOV Slider</label>
<input type="range" id="fov-slider" min="20" max="50" value="45">

<script>
const leftEye = document.getElementById('left-eye');
const rightEye = document.getElementById('right-eye');
const leftContainer = document.getElementById('left-eye-container');
const rightContainer = document.getElementById('right-eye-container');
const menuLeft = document.getElementById('menu-left');
const menuRight = document.getElementById('menu-right');
const fullscreenBtn = document.getElementById('fullscreen-btn');
const fovSlider = document.getElementById('fov-slider');
const overlay = document.getElementById('overlay-start');

let menuSpawned = false;
let menuWorldYaw = 0;
let menuWorldPitch = 0;
let menuPos = { xL: 0, yL: 0, xR: 0, yR: 0 };

const smoothing = 0.25;
const yawSensitivity = 3.0; // increased speed
const pitchSensitivity = 2.0;
const baseGap = 20;
const defaultWidth = 45;

// Camera start
overlay.addEventListener('touchstart', async () => {
  overlay.style.display = 'none';
  try {
    const stream = await navigator.mediaDevices.getUserMedia({
      video: { width: { ideal: 3840 }, height: { ideal: 2160 }, facingMode: 'environment' },
      audio: false
    });
    leftEye.srcObject = stream;
    rightEye.srcObject = stream;
    leftEye.play(); rightEye.play();
  } catch (err) {
    alert("Camera access denied."); console.error(err);
  }
}, { once: true });

// Fullscreen toggle
fullscreenBtn.addEventListener('click', () => {
  if (document.fullscreenElement) document.exitFullscreen();
  else document.documentElement.requestFullscreen();
});

// Eye scaling & gap
function updateEyeScaleAndGap() {
  const scale = fovSlider.value + '%';
  leftContainer.style.width = scale;
  rightContainer.style.width = scale;
  const dynamicGap = baseGap * (fovSlider.value / defaultWidth);
  leftContainer.style.margin = "0 " + (dynamicGap/2) + "px";
  rightContainer.style.margin = "0 " + (dynamicGap/2) + "px";
}
updateEyeScaleAndGap();
fovSlider.addEventListener('input', updateEyeScaleAndGap);

// Device orientation
let currentYaw = 0, currentPitch = 0;
window.addEventListener('deviceorientation', e => {
  if (e.alpha !== null && e.beta !== null) {
    currentYaw = e.alpha;
    currentPitch = e.beta - 90; // normalize pitch
    if (menuSpawned) updateMenuPosition();
  }
});

// Double-tap toggles menu
let lastTap = 0, tapCount = 0;
window.addEventListener('touchend', e => {
  const now = new Date().getTime();
  if (now - lastTap < 300) {
    tapCount++;
    if (tapCount === 2) toggleMenu();
  } else tapCount = 1;
  lastTap = now;
});

function toggleMenu() {
  menuSpawned = !menuSpawned;
  if (menuSpawned) {
    menuWorldYaw = currentYaw;
    menuWorldPitch = currentPitch;
  }
  menuLeft.style.visibility = menuSpawned ? "visible" : "hidden";
  menuRight.style.visibility = menuSpawned ? "visible" : "hidden";
}

function lerp(a, b, t) { return a + (b - a) * t; }

function worldToScreen(menuYaw, menuPitch, rect) {
  let deltaYaw = ((menuYaw - currentYaw + 540) % 360) - 180;
  let deltaPitch = (menuPitch - currentPitch);
  const x = rect.width / 2 - (deltaYaw / 90) * (rect.width / 2) * yawSensitivity - 90;
  const y = rect.height / 2 + (deltaPitch / 45) * (rect.height / 2) * pitchSensitivity;
  return { x, y };
}

function updateMenuPosition() {
  const lRect = leftContainer.getBoundingClientRect();
  const rRect = rightContainer.getBoundingClientRect();
  const targetL = worldToScreen(menuWorldYaw, menuWorldPitch, lRect);
  const targetR = worldToScreen(menuWorldYaw, menuWorldPitch, rRect);
  menuPos.xL = lerp(menuPos.xL, targetL.x, smoothing);
  menuPos.yL = lerp(menuPos.yL, targetL.y, smoothing);
  menuPos.xR = lerp(menuPos.xR, targetR.x, smoothing);
  menuPos.yR = lerp(menuPos.yR, targetR.y, smoothing);
  menuLeft.style.left = menuPos.xL + "px";
  menuLeft.style.top = menuPos.yL + "px";
  menuRight.style.left = menuPos.xR + "px";
  menuRight.style.top = menuPos.yR + "px";
}
</script>
</body>
</html>

