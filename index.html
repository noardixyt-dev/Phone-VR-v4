<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Phone VR/MR Viewer</title>
<style>
  html,body{margin:0;padding:0;overflow:hidden;background:#000;}
  #container{position:relative;width:100vw;height:100vh;display:flex;justify-content:center;align-items:center;}
  canvas.eye{border-radius:12px;margin:0 10px;background:#000;}
  #menu{position:absolute;padding:15px;background:rgba(0,0,0,0.7);border-radius:12px;color:white;font-family:sans-serif;display:none;}
  #fovSlider,#fullscreenBtn{position:absolute;z-index:10;}
  #fovSlider{top:10px;left:10px;width:120px;}
  #fullscreenBtn{top:10px;right:10px;font-size:16px;padding:6px 12px;}
</style>
</head>
<body>
<div id="container">
  <canvas id="leftEye" class="eye"></canvas>
  <canvas id="rightEye" class="eye"></canvas>
  <div id="menu">VR Menu</div>
</div>
<input type="range" id="fovSlider" min="30" max="120" value="70">
<button id="fullscreenBtn">Fullscreen</button>

<script src="https://cdn.jsdelivr.net/npm/three@0.153.0/build/three.min.js"></script>
<script>
(async ()=>{
  const leftCanvas=document.getElementById('leftEye');
  const rightCanvas=document.getElementById('rightEye');
  const leftCtx=leftCanvas.getContext('2d');
  const rightCtx=rightCanvas.getContext('2d');
  const menu=document.getElementById('menu');
  const fovSlider=document.getElementById('fovSlider');
  const fullscreenBtn=document.getElementById('fullscreenBtn');

  let fovScale=0.7, menuVisible=false, menuWorldYaw=0, eyeGap=20;

  function resizeCanvases(){
    const width=window.innerWidth*fovScale*0.5-eyeGap;
    const height=width/1.5;
    leftCanvas.width=rightCanvas.width=width;
    leftCanvas.height=rightCanvas.height=height;
  }

  fovSlider.addEventListener('input',()=>{ fovScale=fovSlider.value/100; resizeCanvases(); });
  fullscreenBtn.addEventListener('click',()=>{ if(!document.fullscreenElement) document.documentElement.requestFullscreen(); else document.exitFullscreen(); });

  resizeCanvases();

  // camera feed
  const stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment', width:{ideal:9999}, height:{ideal:9999}}, audio:false});
  const video=document.createElement('video'); video.srcObject=stream; await video.play();

  function drawLoop(){
    leftCtx.drawImage(video,0,0,leftCanvas.width,leftCanvas.height);
    rightCtx.drawImage(video,0,0,rightCanvas.width,rightCanvas.height);
    requestAnimationFrame(drawLoop);
  }
  drawLoop();

  // world-anchored menu
  window.addEventListener('deviceorientation',e=>{
    if(!menuVisible) return;
    const gamma=e.gamma||0; // yaw
    const centerX=window.innerWidth/2-menu.offsetWidth/2;
    menu.style.left=`${centerX + (menuWorldYaw - gamma)*2}px`;
    menu.style.top=`${window.innerHeight/2 - menu.offsetHeight/2}px`; // fixed vertical
  });

  let lastTap=0;
  window.addEventListener('touchend',e=>{
    const now=Date.now();
    if(now-lastTap<300){
      menuVisible=!menuVisible;
      menu.style.display=menuVisible?'block':'none';
      if(menuVisible) menuWorldYaw=(e.gamma||0)||0;
    }
    lastTap=now;
  });

  window.addEventListener('resize',resizeCanvases);

})();
</script>
</body>
</html>
