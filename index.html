<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>VR Dual Camera HUD</title>
<style>
html,body{margin:0;padding:0;width:100%;height:100%;background:#000;overflow:hidden;}
#root{display:flex;justify-content:center;align-items:center;height:100vh;gap:24px;position:relative;}
canvas{background:#000;border-radius:8px;object-fit:contain;pointer-events:none;}
.menu{position:absolute;display:flex;gap:6px;padding:6px;background:rgba(30,30,30,0.9);border-radius:6px;z-index:10;pointer-events:auto;user-select:none;}
button{padding:5px 10px;font-size:13px;cursor:pointer;background:#111;color:white;border:1px solid #333;border-radius:4px;}
</style>
</head>
<body>
<div id="root">
  <canvas id="left"></canvas>
  <canvas id="right"></canvas>
</div>

<video id="video" autoplay playsinline muted style="display:none"></video>

<script>
const video = document.getElementById('video');
const left = document.getElementById('left');
const right = document.getElementById('right');
let stream = null, raf = null;

// ---------- MENU ----------
let menuVisible = false;
let spawnAlpha = 0, spawnBeta = 0;
const menuLeft = document.createElement('div');
menuLeft.className = 'menu';
const menuRight = document.createElement('div');
menuRight.className = 'menu';
['Start Camera', 'Fullscreen'].forEach(t=>{
  const bL = document.createElement('button');
  const bR = document.createElement('button');
  bL.textContent = bR.textContent = t;
  bL.onclick = bR.onclick = ()=> {
    if(t==='Start Camera') startCamera();
    if(t==='Fullscreen') toggleFullscreen();
  }
  menuLeft.appendChild(bL);
  menuRight.appendChild(bR);
});
document.body.appendChild(menuLeft);
document.body.appendChild(menuRight);
menuLeft.style.display='none';
menuRight.style.display='none';

// ---------- FULLSCREEN ----------
function toggleFullscreen() {
  if(!document.fullscreenElement) document.documentElement.requestFullscreen();
  else document.exitFullscreen();
}

// ---------- START CAMERA ----------
async function startCamera(){
  try{
    const constraints = {video:{facingMode:'environment', width:{ideal:4096}, height:{ideal:2160}, frameRate:{ideal:60}}, audio:false};
    stream = await navigator.mediaDevices.getUserMedia(constraints);
    video.srcObject = stream;
    await video.play();
  }catch(e){alert('Camera error: '+e.message);}
}

// ---------- CANVAS ----------
function resizeCanvases(){
  const size = Math.min(window.innerWidth/2, window.innerHeight);
  [left,right].forEach(c=>{
    c.style.width=c.style.height=size+'px';
    c.width=c.height=size*(window.devicePixelRatio||1);
  });
}
window.addEventListener('resize', resizeCanvases);
resizeCanvases();

// ---------- DEVICE ORIENTATION ----------
let alpha=0,beta=0,gamma=0;
window.addEventListener('deviceorientation', e=>{
  alpha = e.alpha || 0;
  beta = e.beta || 0;
  gamma = e.gamma || 0;
});

// ---------- DRAW LOOP ----------
function drawLoop(){
  const w = left.width, h = left.height;
  const ctxL = left.getContext('2d');
  const ctxR = right.getContext('2d');
  ctxL.clearRect(0,0,w,h);
  ctxR.clearRect(0,0,w,h);

  if(video.videoWidth && video.videoHeight){
    const size = Math.min(video.videoWidth, video.videoHeight);
    const sx = (video.videoWidth - size)/2;
    const sy = (video.videoHeight - size)/2;
    ctxL.imageSmoothingEnabled = ctxR.imageSmoothingEnabled = false;
    ctxL.drawImage(video,sx,sy,size,size,0,0,w,h);
    ctxR.drawImage(video,sx,sy,size,size,0,0,w,h);
  }

  if(menuVisible){
    updateMenuPosition();
    drawCrosshair(ctxL,w,h);
    drawCrosshair(ctxR,w,h);
  }

  raf = requestAnimationFrame(drawLoop);
}

// ---------- CROSSHAIR ----------
function drawCrosshair(ctx,w,h){
  const radius=8;
  ctx.strokeStyle='white';
  ctx.fillStyle='transparent';
  ctx.beginPath();
  ctx.arc(w/2,h/2,radius,0,2*Math.PI);
  ctx.fill();
  ctx.stroke();
}

// ---------- MENU POSITION ----------
let baseX=0, baseY=0;
function updateMenuPosition(){
  const sensitivity = 3;
  const dx = (spawnAlpha - alpha)*sensitivity;
  const dy = (spawnBeta - beta)*sensitivity;

  const wLeft = left.clientWidth, hLeft = left.clientHeight;
  const wRight = right.clientWidth, hRight = right.clientHeight;

  menuLeft.style.left = Math.min(Math.max(baseX+dx,0), wLeft-menuLeft.offsetWidth)+'px';
  menuLeft.style.top  = Math.min(Math.max(baseY+dy,0), hLeft-menuLeft.offsetHeight)+'px';

  menuRight.style.left = Math.min(Math.max(baseX+dx,0), wRight-menuRight.offsetWidth)+'px';
  menuRight.style.top  = Math.min(Math.max(baseY+dy,0), hRight-menuRight.offsetHeight)+'px';

  menuLeft.style.display='flex';
  menuRight.style.display='flex';
}

// ---------- DOUBLE TAP ----------
let lastTap = 0;
window.addEventListener('touchstart', e=>{
  const now = Date.now();
  if(now - lastTap < 300){
    menuVisible = !menuVisible;
    if(menuVisible){
      spawnAlpha = alpha;
      spawnBeta = beta;
      baseX = left.clientWidth/2 - menuLeft.offsetWidth/2;
      baseY = left.clientHeight/2 - menuLeft.offsetHeight/2;
      updateMenuPosition();
    }else{
      menuLeft.style.display='none';
      menuRight.style.display='none';
    }
  }
  lastTap = now;
});

// ---------- START ----------
drawLoop();
</script>
</body>
</html>
